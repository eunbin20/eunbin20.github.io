---
title: GraphQL이란? REST API의 한계와 GraphQL을 사용하는 이유
date: 2022-03-10 11:58:47 +09:00
modified: 2022-03-10 11:58:47 +09:00
tags: [graphQL, web]
description: GraphQL의 정의와 REST API의 한계를 알아보고 이를 GraphQL에서 어떻게 극복할 수 있는지알아본다. GraphQL을 사용하는 이유와 GraphQL의 장단점을 간단한 예제와 함께 알아본다.
image:
---

##### Resources

# GraphQL

# GraphQL이란

> [GraphQL 공식 문서]
> GraphQL is a query language for your API, and a server-side runtime for executing queries using a type system you define for your data. GraphQL isn't tied to any specific database or storage engine and is instead backed by your existing code and data.

GraphQL은 **API를 위한 쿼리언어**이고 데이터에 정의한 **타입을 사용하여 쿼리를 실행**하기 위한 서버사이드 런타임이다. GraphQL은 특정한 데이터베이스 또는 저장소 엔진에 연결되지 않고 기존 코드와 데이터를 이용해 백업된다.

>

- REST API의 한계를 보완하고자 facebook이 개발한 쿼리언어
- **웹 클라이언트 측에서 서버로부터 데이터를 효율적으로 가져오는 것을 목적**으로 하는 쿼리 언어이고 동시에 쿼리문을 통해 데이터를 받을 수 있는 런타임
- 데이터 객체 간의 관계를 그래프로 표현
- 단 한번에 필요한 정보만 불러오는 효율적인 API

## REST API

- 웹에서 http프로토콜을 최대한 잘 활용하여 네트워크를 통해 데이터를 주고받기 위해 API(Application Program Interface)를 설계 할 때 지켜야하는 **제약 조건**
- 리소스 별로 endpoint를 가진다. endpoint의 집합

## RestAPI vs GraphQL

- **REST API**

  - **url과 CRUD메소드의 조합**으로 데이터 fetching
  - 개발 프로세스
    서버측에서 데이터를 모델링하여 각각의 데이터타입마다 endpoint를 만든다.
    ⬇️
    해당 endpoint별 리소스에 대한 내용을 클라이언트 개발자와 커뮤니케이션한다.
    ⬇️
    클라이언트 개발자는 서버개발자가 구축한 REST API에 맞추어 url과 메소드를 조합해 데이터를 요청한다.

- **GraphQL**

  - _캐싱이 어렵다_

  - 개발 프로세스
    서버측에서는 데이터의 타입들을 그래프로 만들고 각각의 그래프에 대해 쿼리 연결 → 자동으로 트리 구조(+ doc)가 생성된다.
    ⬇️
    클라이언트측에서는 만들어진 트리구조와 Document를 보고 코드를 작성해 선언적으로 데이터를 요청한다.
    (추가적인 커뮤니케이션 비용x)

![Untitled](GraphQL%207517b/Untitled.png)

### GraphQL이 해결해주는 기존 방식(REST API)의 문제점

1. OverFetching

   - REST API는 필요한 정보를 가져오기위해서, 쓸데없는 정보도 같이 가져와야하는 Over-fetching 문제

   ➡️  **GraphQL은 필요한 정보만 선택해서 가져올 수 있다.**

2. UnderFetching

   - REST API는 여러개의 데이터를 가져오려면, 여러개의 요청이 필요하는 Under-fetching 문제

   ➡️  **GraphQL은 하나의 요청으로 여러개의 데이터를 한번에 가져올 수 있다.**

## GraphQL 구조

### Schema

- API가 무엇을 할 수 있나?
- GraphQL API가 **처리할 수 있는 모든 데이터를 설명**한 것
- 타입을 가진 필드들을 그래프로 나타낸 것
- 개채유형으로 구성됨 → 어떤 종류의 개체를 요청할 수 있는지, 어떠한 필드가 있는 지 정의
- 네가 사용자에게 보내거나 사용자로부터 받을 데이터에 대한 **설명**
- 무엇을 받을지, 무엇을 줄지에 대한 설명

### Resolver

- 어디서, 어떻게 값을 가져올지를 지시하는 역할
- 스키마의 각 필드는 리졸버 함수와 연동된다.
- 실행 중 값을 생산하기 위해 리졸버 함수가 호출된다.

### Query

- 데이터를 읽는 데 사용(CRUD 중 Read)
- 요청과 응답의 구조가 직관적, 선언적
- GraphQL 쿼리는 **문자열 형태로 서버로 전송**, 서버에서 해석되고 이행된 뒤 다시 **JSON 형태로 반환됨**
- example) 깃허브 리포지토리의 이슈를 조회

```graphql
query GetIssueInfo {
	// 조회할 리포지토리의 작성자(owner), 제목(title)을 인수로 지정
	repository(owner: "jscomplete", title: "graphql-in-action") {
		// 첫 번째 이슈 반환
		issue(number: 1) {
			id
			titile
		}
	}
}
// 인수로 넣은 정보와 매치되는 이슈의 아이디와 제목이 반환된다.
```

### Mutation

- 데이터를 변조하는 데 사용(CRUD 중 Create, Update, Delete)
- example) 깃허브 리포지토리 이슈에 댓글 추가하기

```graphql
mutation AddCommentToIssue {
	// 입력할 인수: 이슈의 아이디, 입력할 댓글
	addComment(input: {
		subjectId: "abca1237"
		body: "Hello~!"
	}) {
		commentEdge {
			node {
				createdAt // 해당 댓글의 작성 시점이 반환됨.
			}
		}
	}
}
// 입력한 인수를 이용해 새로운 댓글이 작성되고 해당 댓글이 작성된 시점이 반환된다.
```

## GraphQL의 이점

1. 빠르고 유연하다
   1. 필요한 데이터에 대해서만 클라이언트가 쿼리를 작성하여 요청
   2. 선언적 호출로 원하는 데이터를 한 번에 가져올 수있다.
2. 높은 생산성
   1. 자동적으로 문서화되므로 문서와 API를 별도로 관리하지 않아도 된다.
      (+ 서버 엔지니어와 클라이언트 엔지니어의 커뮤니케이션 비용 절감)
   2. **엄격하게 타입이 정의**되어 클라이언트와 서버 간 통신 오류를 줄여줌
   3. 백엔드 API에 대한 의존성 낮음
      (클라이언트 개발자는 서버에 저장된 데이터의 구조나 데이터 관계를 이해할 필요가 없다)
3. GraphQL + Apollo Client의 조합으로 Redux를 대체할 수 있다.
   fetch로 API를 가져오고 json파일을 핸들링하고,,,이 작업들을 다 해줌
   app의 local state를 관리하여 Redux를 대체할 수 있다.

## GraphQL Client Library

프론트엔드 애플리케이션과 백엔드의 GraphQL 커뮤니케이션을 관리한다.

- Relay : Facebook이 개발. 리액트용으로 설계된 클라이언트 라이브러리. 성능 최적화
- **Apollo**
  - 쿼리를 작성하면 GraphQL에 데이터를 요청하고 캐싱하고 UI까지 업데이트해줌. 다중 뷰 라이브러리를 지원하는 가장 인기 있는 클라이언트.
  - React 외에 Android나 ios도 지원
- AWS Amplify: 클라우드 서비스를 이용한 애플리케이션 개발 툴. GraphQL backend과 리액트 컴포넌트를 지원한다.
- urql: React에 포커싱되어있는 역동적인 라이브러리. 단순성과 확장성에 중점.
- ... 더 많은 라이브러리 정보는 [여기](https://graphql.org/code/)

## Apollo Client

- GraphQL의 그래프 구조에 사용할 수 있는 강력한 캐시 저장소를 제공
- local state 관리 툴(Redux, 리액트 Context)을 대체할 수 있다.
  → `@client` 지시문을 이용하면 해당 쿼리를 클라이언트에서만 사용
- 뷰 컴포넌트와 로직을 단순화해줌.
- Hooks 제공(useQuery, useMutation,,)
  - 기존 HOC 방식에 비해 가독성 높고 편리하게 GraphQL API를 호출할 수 있다.

## GraphQL + Apollo Client 직접 구현해보기

[https://github.com/eunbin20/graphql_example](https://github.com/eunbin20/graphql_example)

스토리플레이의 graphQL 서버를 이용해 공지사항 데이터를 요청하는 간단한 프로젝트를 만들어보겠습니다.

소스코드는 이해를 돕기 위해 일부 생략하였습니다.

- 우선 CRA로 React 앱을 만들기

```bash
npx create-react-app sample-gql
```

- 구현에 필요한 패키지를 설치

```bash
npm i apollo-boost graphql react-apollo
```

`apollo-boost`: Apollo에서 제공하는 GraphQL 클라이언트 패키지

`graphql`: Facebook에 정의한 GraphQL 스팩을 JavaScript 언어로 구현한 패키지

`react-apollo`: React 앱에 Apollo Client를 연결(Integration)해주는 패키지

- Apollo Client를 생성(index.js)

```jsx
import App from "./App";
import ApolloClient from "apollo-boost";
import { ApolloProvider } from "react-apollo";
// 클라이언트 생성
const client = new ApolloClient({
  uri: "https://dev-api.storyplay.com/graphql", // 스플 dev-api uri
});

ReactDOM.render(
  <ApolloProvider client={client}>
    <App />
  </ApolloProvider>,
  document.getElementById("root")
);
```

- graphQL playground를 통해 데이터의 타입과 구조를 확인할 수 있다.(schema)
  - `listNotice` 를 검색한 결과
    ![스크린샷 2022-02-10 오후 3.59.31.png](GraphQL%207517b/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-02-10_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.59.31.png)
  - `listNotice` 쿼리는 `ListableNoticeInput` 이라는 객체를 argument로 가진다
  - `ListableNotice`라는 객체형태로 데이터를 반환
  - argument를 넣기 위해 `ListableNoticeInput` 의 형태를 확인
    ![스크린샷 2022-02-10 오후 4.08.28.png](GraphQL%207517b/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-02-10_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.08.28.png)
- 쿼리 작성하기(App.js)

  1. `react-apollo`에서 제공하는 HOC <Query>컴포넌트를 이용해 API를 호출

  ```jsx
  import { gql } from 'apollo-boost';
  import { Query } from 'react-apollo';

  const GET_NOTICE = gql`
    query {
  		listNotice(data: { page: 1, pageSize: 100, filter: null }) {
  			list {
  				createdAt
  				noticeId
  				title
  				contents
  			}
  		}
  	}
  `;

  function App() {
    return (
        <Query query={GET_NOTICE}>
          {({ loading, error, data }) => {
            return (
                {data.listNotice.list.map((notice) => {
                  return (
                    <div key={notice.noticedId}>
                      <h1>{notice.title}</h1>
                      <p>{notice.contents}</p>
                      <p>발행 날짜: {notice.createdAt}</p>
                    </div>
                  )
                })}
            );
          }}
        </Query>
      </>
    );
  }
  ```

  1. useQuery Hook을 사용해 GraphQL 호출하기

  ```bash
  npm i @apollo/react-hooks
  ```

  - index.js 수정(`@apollo/react-hooks`패키지에서 임포트한 `ApolloProvider`컴포넌트로 앱의 최상위 컴포넌트 교체)

  ```jsx
  // import { ApolloProvider } from 'react-apollo';
  import { ApolloProvider } from "@apollo/react-hooks";
  ```

  - App.js 수정(HOC로 실행했던 GraphQL API를 hook으로 대체)

  ```jsx
  ...
  import { useQuery } from "@apollo/react-hooks";
  ...
  function App() {
    const { loading, error, data} = useQuery(GET_NOTICE);

    return (
        {data.listNotice.list.map((notice) => {
          return (
            <React.Fragment key={notice.noticedId}>
              <h2>{notice.title}</h2>
              <p>{notice.contents}</p>
              <p>발행 날짜: {notice.createdAt}</p>
            </React.Fragment>
          )
        })}
    );
  }
  ```

- 앱 실행 결과

![ezgif.com-gif-maker.gif](GraphQL%207517b/ezgif.com-gif-maker.gif)

# Reference

[GraphQL 개념잡기](https://tech.kakao.com/2019/08/01/graphql-basic/)

[#1. GraphQL 개념 및 개요](https://velog.io/@jangwonyoon/1.-GraphQL-%EA%B0%9C%EB%85%90)

![Untitled](GraphQL%207517b/Untitled%201.png)

**GraphQL in Action - 사메르부나(한빛 미디어)**

[Hyeseong's Blog - (번역) Thinking in GraphQL](https://blog.cometkim.kr/posts/thinking-in-graphql-ko/)

[[번역] GraphQL은 어떻게 Redux를 대체하는가](https://velog.io/@minsangk/%EB%B2%88%EC%97%AD-GraphQL%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-Redux%EB%A5%BC-%EB%8C%80%EC%B2%B4%ED%95%98%EB%8A%94%EA%B0%80-cijz6lfvf4)
